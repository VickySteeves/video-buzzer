<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <p>Join using this URL: <a id="joinurl" style="font-family: monospace; text-decoration: none;">...</a></p>
    <p><input type="file" id="selector" accept="video/*" /></p>
    <p><video id="player" controls></video></p>
    <script>
var currentPath = window.location.pathname; // "/video/1234"
var videoId = currentPath.substring(7); // "1234"

var videoPlayer = document.getElementById("player");

// Select a local video
var fileSelector = document.getElementById("selector");
function setVideo() {
  var file = fileSelector.files[0];
  console.log(file);
  var videoType = file.type;
  console.log(videoType);
  var canPlay = videoPlayer.canPlayType(videoType);
  console.log(canPlay);
  if(canPlay === "" || canPlay === "no") {
    alert("Video format not supported");
    return;
  }
  var fileURL = URL.createObjectURL(file);
  videoPlayer.src = fileURL;
}

fileSelector.addEventListener("change", setVideo);

// Show join URL
var joinUrl = document.getElementById("joinurl");
var url = window.location.protocol + "//" + window.location.host + "/" + videoId;
joinUrl.innerText = url;
joinUrl.href = url;

// Receive buzzes
var wsProto = "wss:";
if(window.location.protocol === "http:") {
  wsProto = "ws:";
}
var socket;
function connect() {
  console.log("Connecting...");
  socket = new WebSocket(wsProto + "//" + window.location.host + "/api/host/" + videoId);
  socket.addEventListener("open", function() { console.log("Connected"); });
  socket.addEventListener("message", function(e) {
    console.log("Message: ", e.data);
  });
  socket.addEventListener("close", function() { setTimeout(connect, 2000); });
}
connect();
    </script>
  </body>
</html>
